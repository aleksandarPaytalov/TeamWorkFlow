@model AllProjectsQueryModel
@{
	ViewBag.Title = "All Project";
}

@{
	var previousPage = Model.CurrentPage - 1;
	if (previousPage < 1)
	{
		previousPage = 1;
	}

	var maxPage = Math.Ceiling((decimal)Model.TotalProjectsCount / (decimal)Model.ProjectsPerPage);
}

<h2 class="text-center">@ViewBag.Title</h2>

@if (User?.Identity?.IsAuthenticated ?? false)
{
	if (User.IsAdmin())
	{
		<a class="btn btn-success"  asp-area="" asp-controller="Project" asp-action="Add">Add Project</a>
		<hr />
	}

	<form method="get">
		<div class="row">
			<div class="form-group col-md-4">
				<div class="form-group">
					<label asp-for="Search"></label>
					<input asp-for="Search" class="form-control" placeholder="Search by project name or number...">
				</div>
			</div>

			<div class="form-group col-md-4">
				<div class="form-group">
					<label asp-for="Sorting"></label>
					<select asp-for="Sorting" class="form-control" onchange="this.form.submit()">
						<option value="0">Last added project</option>
						<option value="1">By name ascending</option>
						<option value="2">By name descending</option>
						<option value="3">By project number ascending</option>
						<option value="4">By project number descending</option>
						<option value="5">By status ascending</option>
						<option value="6">By status descending</option>
						<option value="7">By total parts ascending</option>
						<option value="8">By total parts descending</option>
					</select>
				</div>
			</div>

			<div class="col-md-4">
				<div class="form-group mt-4 p-2">
					<input type="submit" value="Search" class="btn btn-primary" />
					<a asp-action="All" class="btn btn-secondary">Clear</a>
				</div>
			</div>
		</div>
	</form>
	<hr />
	
<div class="text-center row">
	@foreach (var p in Model.Projects)
	{
		<div class="card col-4" style="width: 20rem; margin-bottom: 20px;">
			<div class="card-body">
				<h4 class="card-title mt-1">@p.ProjectName</h4>
				<h5 class="mb-0"><span class="fw-bold">Project Number: </span>@p.ProjectNumber</h5>
				<h5 class="mb-0"><span class="fw-bold">Status: </span>@p.Status</h5>
				<p class="mb-0"><span class="fw-bold">Total Parts: </span>@p.TotalParts</p>
			</div>

			<div class="row">
				@if (User.IsAdmin())
				{
					<div class="col">
						<a asp-controller="Project" asp-action="Details" asp-route-id="@p.Id" class="btn btn-warning mb-2 w-100 p-2 fw-bold"
						   asp-route-extension="@p.GetProjectExtension()">Details</a>
					</div>
						<div class="col">
							<a asp-controller="Project" asp-action="Edit" asp-route-id="@p.Id" class="btn btn-warning mb-2 w-100 p-2 fw-bold"
							   asp-route-extension="@p.GetProjectExtension()">Edit</a>
						</div>
						<div class="col">
							<a asp-controller="Project" asp-action="Delete" asp-route-id="@p.Id" class="btn btn-danger mb-2 w-100 p-2 fw-bold"
							   asp-route-extension="@p.GetProjectExtension()">Delete</a>
						</div>
				}
				else if (User.IsOperator())
				{
						<div class="col">
							<a asp-controller="Project" asp-action="Details" asp-route-id="@p.Id" class="btn btn-warning mb-2 w-100 p-2 fw-bold"
							   asp-route-extension="@p.GetProjectExtension()">Details</a>
						</div>
				}
			</div>
		</div>
	}
</div>

@if (maxPage > 1)
{
	<nav aria-label="Page navigation">
		<ul class="pagination justify-content-center">
			@if (Model.CurrentPage > 1)
			{
				<li class="page-item">
					<a class="page-link"
					   asp-action="All"
					   asp-route-currentPage="@(Model.CurrentPage - 1)"
					   asp-route-search="@Model.Search"
					   asp-route-sorting="@Model.Sorting">Previous</a>
				</li>
			}

			@for (int i = Math.Max(1, Model.CurrentPage - 2); i <= Math.Min((int)maxPage, Model.CurrentPage + 2); i++)
			{
				<li class="page-item @(i == Model.CurrentPage ? "active" : "")">
					<a class="page-link"
					   asp-action="All"
					   asp-route-currentPage="@i"
					   asp-route-search="@Model.Search"
					   asp-route-sorting="@Model.Sorting">@i</a>
				</li>
			}

			@if (Model.CurrentPage < maxPage)
			{
				<li class="page-item">
					<a class="page-link"
					   asp-action="All"
					   asp-route-currentPage="@(Model.CurrentPage + 1)"
					   asp-route-search="@Model.Search"
					   asp-route-sorting="@Model.Sorting">Next</a>
				</li>
			}
		</ul>
	</nav>
}
}

@section Scripts {
	<partial name="_ValidationScriptsPartial"/>
}
