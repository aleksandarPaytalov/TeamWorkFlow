@*
    Time Tracking Widget for Task Cards
    Displays time tracking controls and progress for authorized users
*@

@if (User.IsAdmin() || User.IsOperator())
{
    <div class="time-tracking-widget" data-task-id="@ViewBag.TaskId">
        <!-- Widget Header -->
        <div class="time-tracking-header">
            <div class="time-tracking-title">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <span>Time Tracking</span>
            </div>
            <div class="time-tracking-status" id="tracking-status-@ViewBag.TaskId">
                <span class="status-indicator status-inactive"></span>
                <span class="status-text">Not Started</span>
            </div>
        </div>

        <!-- Progress Section -->
        <div class="time-tracking-progress">
            <div class="progress-info">
                <div class="progress-label">
                    <span>Progress</span>
                    <span class="progress-percentage" id="progress-percentage-@ViewBag.TaskId">0%</span>
                </div>
                <div class="time-info">
                    <span class="actual-time" id="actual-time-@ViewBag.TaskId">0h 0m</span>
                    <span class="estimated-time">/ @(ViewBag.EstimatedTime ?? 0)h</span>
                </div>
            </div>
            <div class="progress-bar-container">
                <div class="progress-bar" id="progress-bar-@ViewBag.TaskId">
                    <div class="progress-fill" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Current Session Display (Hidden by default) -->
        <div class="current-session" id="current-session-@ViewBag.TaskId" style="display: none;">
            <div class="session-info">
                <div class="session-timer">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span class="timer-display" id="session-timer-@ViewBag.TaskId">00:00:00</span>
                </div>
                <div class="session-type" id="session-type-@ViewBag.TaskId">Development</div>
            </div>
        </div>

        <!-- Control Buttons -->
        <div class="time-tracking-controls">
            <div class="primary-controls">
                <button class="time-btn time-btn-start" id="start-btn-@ViewBag.TaskId" data-task-id="@ViewBag.TaskId">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h8m-9-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Start
                </button>
                
                <button class="time-btn time-btn-pause" id="pause-btn-@ViewBag.TaskId" data-task-id="@ViewBag.TaskId" style="display: none;">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Pause
                </button>
                
                <button class="time-btn time-btn-resume" id="resume-btn-@ViewBag.TaskId" data-task-id="@ViewBag.TaskId" style="display: none;">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h8m-9-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Resume
                </button>
                
                <button class="time-btn time-btn-finish" id="finish-btn-@ViewBag.TaskId" data-task-id="@ViewBag.TaskId" style="display: none;">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Finish
                </button>
            </div>
        </div>

        <!-- Quick Action Buttons -->
        <div class="time-tracking-actions">
            <button class="action-btn-small history-btn" data-task-id="@ViewBag.TaskId" title="View Session History">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                History
            </button>
            
            <button class="action-btn-small variance-btn" data-task-id="@ViewBag.TaskId" title="View Time Variance">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
                Variance
            </button>
        </div>

        <!-- Loading Indicator -->
        <div class="time-tracking-loading" id="loading-@ViewBag.TaskId" style="display: none;">
            <div class="loading-spinner"></div>
            <span>Processing...</span>
        </div>
    </div>
}
